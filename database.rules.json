{
  "rules": {
    /* block any top-level access without session-ID */
    ".read": "false",
    ".write": "false",
    "sessions": {
      "$sessionId": {
        /* Allow new sessions and added votes */
        ".read": "auth != null",
        ".write": "auth != null && !data.exists()",
        ".indexOn": ["author"],
        ".validate": "newData.hasChild('votings')",
        /* Validate Session Data */
        "author": {
          ".validate": "newData.isString() && newData.val() == auth.uid && newData.parent().child('timestamp').exists()"
        },
        "timestamp": {
          ".validate": "newData.val() <= now"
        },
        "title": {
          ".validate": "newData.isString() && newData.val().length <= 100 && newData.parent().child('author').exists()"
        },
        "subtitle": {
          ".validate": "newData.isString() && newData.val().length <= 150"
        },
        "description": {
          ".validate": "newData.isString() && newData.val().length <= 2000"
        },
        "imgUrl": {
          ".validate": "(!newData.exists() || newData.val().length == 0) || (newData.isString() && newData.val().length <= 500 && newData.val().beginsWith('http'))"
        },
        "quorum": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 100"
        },
        "$other": { ".validate": "false" },
        "users": {
          ".validate": "newData.exists()",
          "$userId": {
            "name": {
              ".validate": "newData.isString() && newData.val().length <= 50"
            },
            "email": {
              ".validate": "newData.isString() && newData.val().length < 70"
            },
            "emailHash": {
              ".validate": "newData.isString() && newData.val().length < 70"
            },
            "imgUrl": {
              ".validate": "(!newData.exists() || newData.val().length == 0) || (newData.isString() && newData.val().length <= 500 && newData.val().beginsWith('http'))"
            },
            "$other": { ".validate": "false" }
          }
        },
        "votings": {
          ".validate": "newData.exists()",
          "$votingId": {
            "title": {
              ".validate": "newData.isString() && newData.val().length <= 100"
            },
            "description": {
              ".validate": "newData.isString() && newData.val().length <= 2000"
            },
            "imgUrl": {
              ".validate": "(!newData.exists() || newData.val().length == 0) || (newData.isString() && newData.val().length <= 500 && newData.val().beginsWith('http'))"
            },
            "$other": { ".validate": "false" },
            "votes": {
              ".write": "auth != null && !data.exists()",
              ".validate": "!newData.parent().parent().parent().child('title').exists() && !newData.parent().parent().parent().child('description').exists() && !newData.parent().parent().parent().child('subtitle').exists() && !newData.parent().parent().parent().child('users').exists()",
              "$userId": {
                ".validate": "newData.hasChildren(['author', 'timestamp', 'vote'])",
                "author": {
                  ".validate": "newData.isString() && newData.val() == auth.uid"
                },
                "timestamp": {
                  ".validate": "newData.val() <= now"
                },
                "vote": {
                  ".validate": "newData.isString() && newData.val().length < 50"
                },
                "$other": { ".validate": "false" }
              }
            }
          }
        }
      }
    }
  }
}
